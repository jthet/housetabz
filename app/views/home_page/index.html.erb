<% if current_user.nil? %>
  <!-- Code for new or unsigned users -->
<% else %>
  <% if current_user.house.nil? %>
    <!-- Code for users without a house -->
  <% else %>
    <div class="flex justify-center">
      <div class="w-1/2 mt-40">
        <div class="flex">
          <div class="w-1/2">
            <h2 class="text-2xl font-bold">
              <strong><%= current_user.house.name %></strong>: $<%= current_user.house.total_charge.to_f.ceil(2) %>
            </h2>
            <canvas id="donutChart" style="max-width: 300px;"></canvas>
          </div>
          <div class="w-1/2">
            <h2 class="text-2xl font-bold">
              <strong>My Tab:</strong> $<%= current_user.balance&.amount.to_f.ceil(2) %>
            </h2>
            <canvas id="billsChart" style="max-width: 300px;"></canvas>
          </div>
        </div>
        <div class="flex justify-end mt-4">
          <a href="/checkout" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            Make Payment
          </a>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const donutChartCanvas = document.getElementById('donutChart');
        const billsChartCanvas = document.getElementById('billsChart');
        
        const houseMembers = <%= current_user.house.users.map { |user| user.profile&.first_name }.to_json.html_safe %>;
        const backgroundColor = <%= current_user.house.users.map { |user| user.balance&.amount.to_f.ceil(2) == 0 ? 'green' : 'red' }.to_json.html_safe %>;
        const data = Array(houseMembers.length).fill(1);

        new Chart(donutChartCanvas, {
          type: 'doughnut',
          data: {
            labels: houseMembers.map((user) => `${user}/${houseMembers.length}`),
            datasets: [
              {
                data: data,
                backgroundColor: backgroundColor,
              },
            ],
          },
          options: {
            // Customize chart options and styling here
          },
        });

        new Chart(billsChartCanvas, {
          type: 'doughnut',
          data: {
            labels: ['Bill 1', 'Bill 2', 'Bill 3'], // Update with appropriate bill names
            datasets: [
              {
                data: [10, 20, 30], // Update with appropriate data
                backgroundColor: ['blue', 'orange', 'purple'], // Update with appropriate colors
              },
            ],
          },
          options: {
            // Customize chart options and styling here
          },
        });
      });
    </script>
  <% end %>
<% end %>
