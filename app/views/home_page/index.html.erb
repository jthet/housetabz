<%# This code should be displayed for new users or users that have not signed in. %>
<% if current_user.nil? %>
  <div class="flex flex-col items-center justify-center h-screen">
    <h1 class="text-5xl font-bold mb-2">Hi, Welcome to HouseTabz</h1>
    <h3 class="text-2xl text-gray-600 mb-4">A better way to split your House Tabs</h3>
  </div>
<% else %>
  <%# This code should be displayed for users that are signed in. %>
  <div class="flex justify-center">
    <div class="w-1/2">
      <h2 class="text-2xl font-bold"><%= current_user.house.name %>: $<%= current_user.house.total_charge.to_f.ceil(2) %></h2>

      <% houseMembers = current_user.house.users.map { |user| user.profile.first_name } %>
      <% status = (current_user.house.total_charge.to_f / current_user.house.users.count.to_f).ceil(2) == 0 ? 'Paid' : 'Unpaid' %>
      <% backgroundColor = status == 'Paid' ? 'green' : 'red' %>
      <canvas id="donutChart" style="max-width: 300px;"></canvas>

      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', () => {
          const donutChartCanvas = document.getElementById('donutChart');

          new Chart(donutChartCanvas, {
            type: 'doughnut',
            data: {
              labels: <%= houseMembers.to_json.html_safe %>,
              datasets: [
                {
                  data: [30, 40, 50], // Update with appropriate data
                  backgroundColor: <%= backgroundColor.to_json.html_safe %>,
                },
              ],
            },
            options: {
              // Customize chart options and styling here
            },
          });
        });
      </script>
    </div>

    <p class="text-2xl font-bold"><strong>My Tab:</strong> $<%= (current_user.house&.total_charge.to_f / current_user.house&.users&.count.to_f).ceil(2) %></p>
  </div>
<% end %>
